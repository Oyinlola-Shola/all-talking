<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chats - ALL TALKING</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Chats List View -->
    <div id="chatsView2" class="chat-container">
        <!-- Status Updates Section -->
        <div class="status-updates">
            <div class="status-header">
                <h3>Status Updates</h3>
                <div class="status-actions">
                    <button class="btn-icon">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                </div>
            </div>
            <div class="status-list" id="statusList">
                <!-- Status items will be loaded by JavaScript -->
            </div>
        </div>
        
        <!-- Chats section header -->
        <div class="chats-header">
            <h3 class="section-title">Chats</h3>
           </div>

        <div class="chats-list" id="chatsList">
            <div id="screen"></div>
            <!-- Chats will be loaded here by JavaScript -->
        </div>
        
        <button class="btn-floating" id="plus">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    
    <!-- Chat Interface View -->
     <!-- Chat Interface View -->
    <!-- <div id="chatView" class="chat-interface hidden"> -->
          <div class="chat-header" id="chatHeader">
            <!-- Chat header will be loaded here by JavaScript -->
        </div>
       
        
      <div id="show-chat">
          <div class="messages-container" id="messagesContainer">
            <!-- Messages will be loaded here by JavaScript -->
        </div>
        
        <div class="typing-indicator hidden" id="" id="message">
            <span id="typingText"></span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
     
        
        <div class="message-input-container">
            <button class="emoji-button" id="emojiButton">
                <i class="fas fa-smile"></i>
            </button>
            <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
            <button class="send-button" id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        </div>
        <div class="emoji-picker" id="emojiPicker">
            <!-- Emojis will be loaded here by JavaScript -->
        </div>
    <!-- </div> -->
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="chat.html" class="nav-item active">
            <i class="fas fa-comment"></i>
            <span>Chats</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
        <a href="settings.html" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
    </div>
    
    <!-- Add Chat Modal -->
    <div class="modal" id="addChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Chat</h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="chatName" class="form-label">Chat Name (Optional)</label>
                    <input type="text" id="chatName" class="form-control" placeholder="Enter a name for group chat">
                </div>
                
                <h4>Select Users</h4>
                <div id="userList">
                    <!-- Users will be loaded here by JavaScript -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeModalBtn">Cancel</button>
                <button class="btn btn-primary" id="createChat">Create Chat</button>
            </div>
        </div>
    </div>
    
    <!-- Add Status Modal -->
       <div class="modal" id="addStatusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Status Update</h3>
                <button class="modal-close" id="closeStatusModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="statusText" class="form-label">Status Text</label>
                    <input type="text" id="statusText" class="form-control" placeholder="What's on your mind?">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Upload Image/Video</label>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt fa-2x"></i>
                        <p>Click to upload image or video</p>
                        <input type="file" id="statusMedia" accept="image/*,video/*" hidden>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelStatusBtn">Cancel</button>
                <button class="btn btn-primary" id="postStatusBtn">Post Status</button>
            </div>
        </div>
    </div>
    <script>
        async function getContact(contactName){
            const api = await fetch('http://localhost300/get_contact_api', 
                { method:"POST",
                header:{"content-type":"application/json"},
                body:JSON.stringify({
                   name:contactName
                })
            });
            const response = await api.json();

            if(api.ok){
                if(response.status==="sussess"){
                    document.getElementById("userList").innerHTML=response;
                    document.getElementById("createChat").addEventListener("click", ()=>{
                        document.getElementById("chats-list").innerHTML.innerHTML=response;
                    })

                }
                else{
                    alert("Something went wrong");
                }
            }
        }

        document.getElementById("chatName").addEventListener("keydown", ()=>{
            const chatName = document.getElementById("chatName").value;
            if(chatName===''){
                alert("space must not be empty");
            }
            else{
                getContact(chatName);
            }
        });

        document.getElementById("plus").addEventListener("click", function(){
            document.getElementById("addChatModal").style.display="block";
        });

        document.getElementById("closeModal").addEventListener("click", function(){
            document.getElementById("addChatModal").style.display="none";
        });

        document.getElementById("closeModalBtn").addEventListener("click", ()=>{
            document.getElementById("addChatModal").style.display="none";
        });

        document.getElementById("createChat").addEventListener("click", ()=>{
            document.getElementById("show-chat").style.display="block";
            document.getElementById("addChatModal").style.display="none";
            document.getElementById("chatsView2").style.display="none";
        });

         const emojiButton = document.getElementById('emojiButton');
    const emojiPicker = document.getElementById('emojiPicker');
    
    if (emojiButton && emojiPicker) {
        emojiButton.addEventListener('click', (e) => {
            e.stopPropagation();
            emojiPickerActive = !emojiPickerActive;
            emojiPicker.classList.toggle('active', emojiPickerActive);
            
            if (emojiPickerActive) {
                loadEmojiPicker();
            }
        });
        
  // Close emoji picker when clicking outside
        document.addEventListener('click', (e) => {
            if (!emojiPicker.contains(e.target) && e.target !== emojiButton) {
                emojiPickerActive = false;
                emojiPicker.classList.remove('active');
            }
        });
    }

    function loadEmojiPicker() {
    console.log('Loading emoji picker');
    const emojiPicker = document.getElementById('emojiPicker');
    if (!emojiPicker) return;
    
//// Sample emojis
    const emojiCategories = {
        'Smileys & People': ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¤©', 'ðŸ¥³'],
        'Animals & Nature': ['ðŸµ', 'ðŸ’', 'ðŸ¦', 'ðŸ¦§', 'ðŸ¶', 'ðŸ•', 'ðŸ¦®', 'ðŸ©', 'ðŸº', 'ðŸ¦Š', 'ðŸ¦', 'ðŸ±', 'ðŸˆ', 'ðŸ¦', 'ðŸ¯', 'ðŸ…', 'ðŸ†', 'ðŸ´', 'ðŸŽ', 'ðŸ¦„', 'ðŸ¦“', 'ðŸ¦Œ', 'ðŸ®', 'ðŸ‚', 'ðŸƒ', 'ðŸ„', 'ðŸ·', 'ðŸ–', 'ðŸ—', 'ðŸ½', 'ðŸ', 'ðŸ‘'],
        'Food & Drink': ['ðŸŽ', 'ðŸ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸ«', 'ðŸˆ', 'ðŸ’', 'ðŸ‘', 'ðŸ¥­', 'ðŸ', 'ðŸ¥¥', 'ðŸ¥', 'ðŸ…', 'ðŸ†', 'ðŸ¥‘', 'ðŸ¥¦', 'ðŸ¥¬', 'ðŸ¥’', 'ðŸŒ¶', 'ðŸ«‘', 'ðŸŒ½', 'ðŸ¥•', 'ðŸ«’', 'ðŸ§„', 'ðŸ§…', 'ðŸ¥”', 'ðŸ '],
        'Travel & Places': ['ðŸš—', 'ðŸš•', 'ðŸš™', 'ðŸšŒ', 'ðŸšŽ', 'ðŸŽ', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸ›»', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸ', 'ðŸ›µ', 'ðŸš²', 'ðŸ›´', 'ðŸ›¹', 'ðŸ›¼', 'ðŸš', 'âœˆ', 'ðŸ›©', 'ðŸ›«', 'ðŸ›¬', 'ðŸª‚', 'ðŸ’º', 'ðŸš€', 'ðŸ›¸', 'ðŸš‰', 'ðŸšŠ']
    };
    
    emojiPicker.innerHTML = '';
    
    for (const [category, emojis] of Object.entries(emojiCategories)) {
        const categoryElement = document.createElement('div');
        categoryElement.className = 'emoji-category';
        
        const categoryTitle = document.createElement('h4');
        categoryTitle.textContent = category;
        categoryElement.appendChild(categoryTitle);
        
        const emojiGrid = document.createElement('div');
        emojiGrid.className = 'emoji-grid';
        
        emojis.forEach(emoji => {
            const emojiElement = document.createElement('div');
            emojiElement.className = 'emoji';
            emojiElement.textContent = emoji;
            emojiElement.addEventListener('click', () => {
                const messageInput = document.getElementById('messageInput');
                messageInput.value += emoji;
                messageInput.focus();
                
    //       Show typing indicator when adding emoji
                if (currentChatId) {
                    showTypingIndicator(currentChatId);
                }
            });
            emojiGrid.appendChild(emojiElement);
        });
        
        categoryElement.appendChild(emojiGrid);
        emojiPicker.appendChild(categoryElement);
    }
}
const chatHeader = document.getElementById('chatHeader'); 
const chatName = "Shola";
const status = "Online";
    chatHeader.innerHTML = `
     <button class="back-button" id="backToChats">
         <i class="fas fa-arrow-left"></i>
     </button>
     <div class="chat-title">
         <h2>${chatName}</h2>
         <p id="chatStatus">${status}</p>
     </div>
     <div class="chat-actions">
         <button class="btn-icon" id="voiceCallBtn">
             <i class="fas fa-phone"></i>
         </button>
         <button class="btn-icon" id="videoCallBtn">
             <i class="fas fa-video"></i>
         </button>
         <button class="btn-icon" id="chatMenuBtn">
             <i class="fas fa-ellipsis-v"></i>
         </button>
     </div>
 `;
     document.getElementById('voiceCallBtn').addEventListener('click', () => {
        alert(`Voice call to ${chatName} would start here`);
    });

    document.getElementById('videoCallBtn').addEventListener('click', () => {
        alert(`Video call to ${chatName} would start here`);
    });

    document.getElementById('chatMenuBtn').addEventListener('click', () => {
        alert(`Chat menu for ${chatName} would open here`);
    });
   // Add back button event listener
   document.getElementById('backToChats').addEventListener('click', () => {
      document.getElementById("show-chat").style.display="none";
      document.getElementById("chatsView2").style.display="block";
   });

    const statusList = document.getElementById('statusList');
       statusList.innerHTML = '';
     document.getElementById("show-chat").style.display="none";
    // Add "my status" item
    const myStatusItem = document.createElement('div');
    myStatusItem.className = 'status-item';
    myStatusItem.innerHTML = `
        <div class="status-avatar add-status">
            <i class="fas fa-plus"></i>
            <div class="add-status-btn">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        <div class="status-name">My Status</div>
    `;
    
    myStatusItem.addEventListener('click', showAddStatusModal);
    statusList.appendChild(myStatusItem);
   

   // Show add status modal
function showAddStatusModal() {
    console.log('Showing add status modal');
    const modal = document.getElementById('addStatusModal');
    if (!modal) {
        console.log('Add status modal not found');
        return;
    }
    
    modal.classList.add('active');
    
    // Setup event listeners for the modal
    const closeStatusModal = document.getElementById('closeStatusModal');
    const cancelStatusBtn = document.getElementById('cancelStatusBtn');
    const postStatusBtn = document.getElementById('postStatusBtn');
    const uploadArea = document.getElementById('uploadArea');
    
    if (closeStatusModal) {
        closeStatusModal.onclick = () => modal.classList.remove('active');
    }
    
    if (cancelStatusBtn) {
        cancelStatusBtn.onclick = () => modal.classList.remove('active');
    }
    
    if (uploadArea) {
        uploadArea.onclick = () => document.getElementById('statusMedia').click();
    }
    
        if (postStatusBtn) {
        postStatusBtn.onclick = postStatus;
    }
}

    </script>
    <style>
       
    </style>
    <script src="../js/jquery.js"></script>
    <!-- <script src="../js/script.js"></script> -->
</body>
</html>